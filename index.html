<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>TRPG å“å ±å‘Šãƒ¡ãƒ¼ã‚«ãƒ¼</title>

  <meta property="og:type" content="website">
  <meta property="og:title" content="TRPG å“å ±å‘Š">
  <meta property="og:description" content="å“å ±å‘Šã¾ã¨ã‚">
  <meta property="og:image" content="https://ã“ã“ã«ä»®ã®ç”»åƒURL">


  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 700px;
      margin: auto;
    }
    textarea, input {
      width: 100%;
      margin-bottom: 10px;
      font-size: 14px;
    }
    button {
      padding: 10px 20px;
      font-size: 14px;
      cursor: pointer;
    }
    pre {
      background: #f4f4f4;
      padding: 15px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

<h1>TRPG å“å ±å‘Šãƒ¡ãƒ¼ã‚«ãƒ¼</h1>

<label>ã‚·ã‚¹ãƒ†ãƒ å</label>
<input id="system" value="ã‚¯ãƒˆã‚¥ãƒ«ãƒ•ç¥è©±TRPG">

<label>ã‚·ãƒŠãƒªã‚ªå</label>
<input id="scenario" placeholder="åˆæ‹æ€§ã‚¹ãƒˆãƒƒã‚¯ãƒ›ãƒ«ãƒ ç—‡å€™ç¾¤">

<label>å“å ±å‘Šç”»åƒURL</label>
<input id="imageUrl" placeholder="https://...">


<label>KP</label>
<input id="kp" placeholder="ã‚‹ã‚ã®">

<h2>PL / PC</h2>

<div id="players"></div>

<button onclick="addPlayer()">ï¼‹ äººæ•°è¿½åŠ </button>


<button onclick="generate()">å“å ±å‘Šæ–‡ã‚’ç”Ÿæˆ</button>

<h2>ç”Ÿæˆçµæœ</h2>
<pre id="result"></pre>

<button onclick="copyText()">ã‚³ãƒ”ãƒ¼ã™ã‚‹</button>

<script>
function getParam(name) {
  const params = new URLSearchParams(window.location.search);
  return params.get(name) || "";
}

let playerCount = 0;

function addPlayer(pc = "", pl = "") {
  const container = document.getElementById("players");
  const div = document.createElement("div");
  div.style.marginBottom = "8px";

  div.innerHTML = `
    <input placeholder="PCå" class="pc" value="${pc}">
    <input placeholder="PLå" class="pl" value="${pl}">
    <button onclick="this.parentElement.remove()">å‰Šé™¤</button>
  `;

  container.appendChild(div);
}

function generate() {
  const system = document.getElementById("system").value;
  const scenario = document.getElementById("scenario").value;
  const kp = document.getElementById("kp").value;

  const pcs = document.querySelectorAll(".pc");
  const pls = document.querySelectorAll(".pl");

  let members = "";
  let playersData = [];

  pcs.forEach((pc, i) => {
    const pl = pls[i].value;
    if (pc.value || pl) {
      members += `PC / ${pc.value} - ${pl}\n`;
      playersData.push({ pc: pc.value, pl: pl });
    }
  });

  const text =
`${system}
â—¤ã€€${scenario}ã€€â—¢
KPï¼š${kp}

${members}
áƒ¦ Scenario clear`;

  document.getElementById("result").textContent = text;

  // ğŸ”— URLæ›´æ–°
const imageUrl = document.getElementById("imageUrl").value;

const url =
  `${location.pathname}?` +
  `system=${encodeURIComponent(system)}` +
  `&scenario=${encodeURIComponent(scenario)}` +
  `&kp=${encodeURIComponent(kp)}` +
  `&players=${encodeURIComponent(JSON.stringify(playersData))}` +
  `&image=${encodeURIComponent(imageUrl)}`;

history.replaceState(null, "", url);


function copyText() {
  const text = document.getElementById("result").textContent;
  navigator.clipboard.writeText(text).then(() => {
    alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
  });
}

// ğŸ” URLã‹ã‚‰å¾©å…ƒ
window.onload = () => {
  document.getElementById("system").value = getParam("system");
  document.getElementById("scenario").value = getParam("scenario");
  document.getElementById("kp").value = getParam("kp");

  const players = getParam("players");
  if (players) {
    JSON.parse(players).forEach(p => addPlayer(p.pc, p.pl));
  } else {
    addPlayer();
  }
};
</script>


</body>
</html>


